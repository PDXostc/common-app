<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
 * Copyright (c) 2013, Intel Corporation, Jaguar Land Rover
 *
 * This program is licensed under the terms and conditions of the
 * Apache License, version 2.0.  The full text of the Apache License is at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
-->

<html>

<head>

<meta charset="utf-8" />

<meta name="viewport" content="width=720, height=1280, user-scalable=no" />

<title>Boilerplate application</title>

<script type="text/javascript"
	src="./css/car/components/jQuery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="js/ui/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/jquery.event.drag-2.2.js"></script>

<script type="text/javascript" src="./css/car/components/knockout/knockout.js"></script>

<!-- <link rel="stylesheet" href="css/nouislider.fox.css" type="text/css" media="screen" />  -->

<!-- jsRender Library Import -->
<script type="text/javascript" src="./css/car/components/jsViews/jsrender.js"></script>
<script type="text/javascript" src="./css/car/components/jsViews/template.js"></script>

<script type="text/javascript" src="./js/main.js" charset="utf-8"></script>
<!-- Example WRT Plugin:  include the JS code that creates your Example object.-->
<script type="text/javascript" src="./js/example.js" charset="utf-8"></script>

<link rel="stylesheet" href="./css/car/components/incomingCall/incomingCall.css" />

<link rel="stylesheet" href="./css/car/car.css" />
<script type="text/javascript" src="./css/car/car.js"></script>
<script type="text/javascript" src="./js/services/bootstrap.js"></script>

<script type="text/javascript" src="./css/car/components/boxCaption/boxCaption.js"></script>
<link rel="stylesheet" href="./css/car/components/boxCaption/boxCaption.css" />

<script type="text/javascript" src="./css/car/components/alphabetBookmark/alphabetBookmark.js"></script>
<link rel="stylesheet" href="./css/car/components/alphabetBookmark/alphabetBookmark.css" />

<script type="text/javascript" src="./css/car/components/library/library.js"></script>
<link rel="stylesheet" href="./css/car/components/library/library.css" />

<script type="text/javascript" src="./css/car/components/topBarIcons/topBarIcons.js"></script>
<link rel="stylesheet" href="./css/car/components/topBarIcons/topBarIcons.css" />

<script type="text/javascript" src="./css/car/components/bottomPanel/bottomPanel.js"></script>

<script type="text/javascript" src="./css/car/components/dateTime/dateTime.js"></script>
<link rel="stylesheet" href="./css/car/components/dateTime/dateTime.css" />

<!-- Contains the creation of the tizen.most object, which is the API to the MOST hardware. -->
<script type="text/javascript" src="./css/car/components/audioPlayer/most.js"></script>

<link rel="stylesheet" href="./css/car/components/bottomPanel/volumeSlider.css" />
<script type="text/javascript" src="./css/car/components/bottomPanel/jquery.nouislider.js"></script>

<link rel="stylesheet" href="./css/style.css" />

<title>Application Template</title>

<script type="text/javascript">
/*
	function preloadimages(arr) {
		var newimages = [], loadedimages = 0
		var postaction = function() {
		}
		var arr = (typeof arr != "object") ? [ arr ] : arr
		function imageloadpost() {
			loadedimages++
			if (loadedimages == arr.length) {
				postaction(newimages) //call postaction and pass in newimages array as parameter
			}
		}
		for ( var i = 0; i < arr.length; i++) {
			newimages[i] = new Image()
			newimages[i].src = arr[i]
			newimages[i].onload = function() {
				imageloadpost()
			}
			newimages[i].onerror = function() {
				imageloadpost()
			}
		}
		return { //return blank object with done() method
			done : function(f) {
				postaction = f || postaction //remember user defined callback functions to be called when images load
			}
		}
	}

	preloadimages(
			[ 'img/2d_txt_26_15.svg', 'img/3d_txt_26_15.svg',
					'img/balanceFade_title_328_17.svg',
					'img/car_top_view_215_478.png',
					'img/crosshair_430_952.svg', 'img/dolby_147_80.svg',
					'img/dolby_hover_147_80.svg', 'img/down_move_58_194.svg',
					'img/down_move_hover_58_194.svg', 'img/drag_knob.svg',
					'img/dts_147_80.svg', 'img/dts_hover_147_80.svg',
					'img/left_move_58_194.svg',
					'img/left_move_hover_58_194.svg',
					'img/meridian_147_80.svg', 'img/meridian_hover_147_80.svg',
					'img/meridian2D_147_80.svg',
					'img/meridian2D_hover_147_80.svg', 'img/minus_54_58.svg',
					'img/minus_hover_54_58.svg', 'img/move_right_58_194.svg',
					'img/move_right_hover_58_194.svg',
					'img/off_button_104_56.svg',
					'img/off_button_hover_104_56.svg',
					'img/on_button_104_56.svg',
					'img/on_button_hover_104_56.svg', 'img/plus_54_58.svg',
					'img/plus_hover_54_58.svg',
					'img/static_elements_720_585.svg',
					'img/static_elements_720_1000.svg',
					'img/stereo_147_80.svg', 'img/stereo_hover_147_80.svg',
					'img/surround_header_484_28.svg',
					'img/surround_header_no3d_484_28.svg',
					'img/surround_sound_3d_header_423_56.svg',
					'img/temp_bar_on_left_52_407.svg',
					'img/tone_title_291_16.svg', 'img/up_move_194_58.svg',
					'img/up_move_hover_194_58.svg', 'img/most_bar_off.svg',
					'img/most_bar.svg' ]).done(function(images) {
		//call back codes, for example:
		console.log('img preload complete') //alerts 3
		//alert(images[0].src+" "+images[0].width) //alerts '1.gif 220'
	})
*/
	if (document.getElementById("consoleLogger") != null) {
		//document.getElementById("consoleLogger").innerHTML = string;

	}
	//alert('logit');
	function loggIt(string) {
	};
	jQuery(document)
			.ready(
				function() {

					if (typeof (tizen.most) !== 'undefined') {
						console
								.log("main sees defined defined tizen.most object.");
					}

					initOff();  // Initialize to surround 2D mode.

						// Called when the Bass slider is moved; passes the new value on to the tizen.most API.
						$(".bassSlider")
								.noUiSlider(
									{ range : [ 0, 24 ], step : 1, start : 12, handles : 1, connect : "upper",
										orientation : "vertical", slide : 
										function() 
										{
											updateDisplay($(".bassSlider"), $('.bass_display'))
											if (tizen.most) {
												// Input Range is 0-24.
												// Output rang is same, but ceneterd around 0. 
												//console.log("Bass input is: " + $(".bassSlider").val().toString());

												var curBass = 24 - $(".bassSlider").val();

												var n = curBass - 12;
												if (n < 0)
													n = 256 + n;

												tizen.most.setTone("bass", curBass - 12, 0, function(result) 
																							{
																								console.log(result.message);
																							});
											}
										}
									});
						// Called when the Treble slider is moved; passes the new value on to the tizen.most API.
						$(".trebleSlider")
								.noUiSlider(
										{ range : [ 0, 24 ], step : 1, start : 12, handles : 1, connect : "upper", 
											orientation : "vertical", slide : 
											function() 
											{
												updateDisplay( $(".trebleSlider"), $('.treble_display'))
												if (tizen.most) {
													// Input Range is 0-24.
													// Output rang is same, but ceneterd around 0. 

													var curTreble = 24 - $(".trebleSlider").val();

													var n = curTreble - 12;
													if (n < 0)
														n = 256 + n;

													tizen.most.setTone("treble", curTreble - 12, 0, function(result) 
																									{
																										console.log(result.message);
																									});

												}
											}
										});
						// Called when the Subwoofer slider is moved; passes the new value on to the tizen.most API.
						$(".subSlider")
								.noUiSlider(
										{ range : [ 0, 24 ], step : 1, start : 12, handles : 1, connect : "upper",
											orientation : "vertical", slide : 
											function() 
											{ 
												updateDisplay($(".subSlider"), $('.sub_display'))
												if (tizen.most) {

													var n = 255 - (($(".subSlider").val() * 1) / 2) * 8; // Ranges for subwoofer: input 24 to 0, output, -100 to 0.
												//	console.log("slider input: " + $(".subSlider").val().toString() + " cmd output: " + n.toString());
													i = n;

													tizen.most.setTone("subwoofer", i, 0, function(result) 
																						{
																							console.log(result.message);
																						});

												}
											}
										});

						function updateDisplay(targetSlider, targetDisplay) {
							targetDisplay.html(-(targetSlider.val() - 12));
						}

						function addSubtractOne(btnClicked, targetSlider, targetDisplay) 
						{
							btnClicked
									.mousedown(function() {
										var currentVal = Number(targetSlider
												.val());
										if ($(this).hasClass('plus') == true) {
											currentVal--;
											targetSlider.val(currentVal)
										} else {
											currentVal++;
											targetSlider.val(currentVal)
										}
										updateDisplay(targetSlider,
												targetDisplay);

										// When the buttons surrounding the balance and fader control are activated,
										// send the delta of +/- 1 to tizen.most.
										if (targetSlider.selector == ".bassSlider") {
											tizen.most.setTone("bass", 12 - targetSlider.val(), 0, function(result) 
																									{
																										console.log(result.message);
																									});
										} else if (targetSlider.selector == ".trebleSlider") {
											tizen.most .setTone("treble", 12 - targetSlider.val(), 0, function(result) 
																									  {
																									  	console.log(result.message);
																									  });
										} else if (targetSlider.selector == ".subSlider") {
											var n = 255 - ((targetSlider.val() * 2) / 3) * 8;
											var i = Math.floor(n + 0.5);
											tizen.most.setTone("volume", i, 0, function(result) 
																				{
																					console.log(result.message);
																				});
										}
									});
						}
						addSubtractOne($('.bass'), $('.bassSlider'),
								$('.bass_display'))
						addSubtractOne($('.treble'), $('.trebleSlider'),
								$('.treble_display'))
						addSubtractOne($('.sub'), $('.subSlider'),
								$('.sub_display'))

						function addClassRemoveClassSibling(targetClass,
								theFunction) {
							targetClass.mousedown(function() {
								$(this).addClass('on').siblings().removeClass(
										'on');
								if (theFunction) {
									theFunction($(this));
								}
							});

						}
						addClassRemoveClassSibling($('.on_off_btn'),
								add3D2DStyling);
						addClassRemoveClassSibling($('.surround_btn'), null);

						function add3D2DStyling(targetClass) {
							if (targetClass.hasClass('off_btn') == true) {
								$('.dimension2D').addClass('on').siblings()
										.removeClass('on');
								$('.audioDimensionTxt').removeClass('on');
							} else {
								$('.dimension3D').addClass('on').siblings()
										.removeClass('on');
								$('.audioDimensionTxt').addClass('on');
							}
						}
						var currentFade = 0;
						var currentBalance = 0;
						var prevFade = 0;
						var prevBalance = 0;

						// This is the handler for movement of the 2D thumb in the Fade/Balance control. When there are changes in
						// the vertical or horizontal position of the thumb, send the delta to tizen.most using the sendBalance 
						// or sendFade function.
						function moveLeftRightUpDown(theBtn) {
							theBtn
									.mousedown(function() {
										if ($(this).hasClass('up') == true) {
											if (currentFade > -13) {
												currentFade--;
											}
										} else if ($(this).hasClass('down') == true) {
											if (currentFade < 13) {
												currentFade++;
											}
										}

										if ($(this).hasClass('left') == true) {
											if (currentBalance > -13) {
												currentBalance--;
											}
										} else if ($(this).hasClass('right') == true) {
											if (currentBalance < 13) {
												currentBalance++;
											}
										}
										if ($(this).hasClass('left') == true
												|| $(this).hasClass('right') == true) {
											var theBalanceIncrement = (currentBalance * (90 / 25))
													- 50 + '%';
											$('.crosshair').css({
												left : theBalanceIncrement
											});
										} else if ($(this).hasClass('up') == true
												|| $(this).hasClass('down') == true) {
											var theFadeIncrement = (currentFade * (90 / 25))
													- 50 + '%';
											$('.crosshair').css({
												top : theFadeIncrement
											});
										}

										if ((prevBalance != currentBalance)
												|| !prevBalance) // Only send command to MOST on change.
										{
											sendBalance(currentBalance);
											prevBalance = currentBalance;
										}

										if ((prevFade != currentFade)
												|| !prevFade) // Only send command to MOST on change.		
										{
											sendFade(currentFade);
											prevFade = currentFade;
										}

									})
						}
						// Used by the moveLeftRightUpDown to send changes in balance settings to the tizen.most API.
						function sendBalance(curBal) {

							// Scale range of +/- 13 to 0C to F4

							var n = curBal;
							if (curBal < 0)
								n = 256 + curBal;

							if (tizen.most) {
								tizen.most.setBalance("balance", curBal, 0,
										function(result) {
											console.log(result.message);
	
										}
								);	
							}
						}

						// Used by the moveLeftRightUpDown to send changes in fade settings to the tizen.most API.
						function sendFade(curFade) {
							// Scale range of +/- 12 to 0C to F4
							// Need to reverse this to get front/rear sense correct.
							curFade = -curFade;
							var n = curFade;
							if (curFade < 0)
								n = 256 + curFade;
							if (tizen.most) {
								tizen.most.setBalance("fade", curFade, 0, 
										function(result) {
											console.log(result.message);
										}
								);
							}
						}
						// This is another handler for movement of the 2D thumb in the Fade/Balance control. When there are changes in
						// the vertical or horizontal position of the thumb, send the delta to tizen.most using the sendBalance 
						// or sendFade function.
						moveLeftRightUpDown($('.bf_btn'));
						function moveCrossHair(thisElem, theEvent) {
							theW = $('body').width();
							theH = $('body').height();
							var aHorizontalUnit = (theW * .29861111) / 25;
							var aVerticalUnit = (theH * .478) / 25;
							var parentOffset = thisElem.offset();
							//or $(this).offset(); if you really just want the current element's offset
							var relX = theEvent.pageX - parentOffset.left
									- thisElem.width() / 2;
							var relY = theEvent.pageY - parentOffset.top
									- thisElem.height() / 2;
							var xInc = (relX / aHorizontalUnit);
							var yInc = (relY / aVerticalUnit)
							if (xInc < -0.5) {
								currentBalance = Math.floor(xInc);
							} else if (xInc > 0.5) {
								currentBalance = Math.ceil(xInc);

							} else {
								currentBalance = 0;
							}

							if (yInc < -0.5) {
								currentFade = Math.floor(yInc);
							} else if (yInc > 0.5) {
								currentFade = Math.ceil(yInc);

							} else {
								currentFade = 0;
							}

							if ((prevBalance != currentBalance) || !prevBalance) // Only send command to MOST on change.
							{
								sendBalance(currentBalance);
								prevBalance = currentBalance;
							}

							if ((prevFade != currentFade) || !prevFade) // Only send command to MOST on change.		
							{
								sendFade(currentFade);
								prevFade = currentFade;
							}
							var theBalanceIncrement = (currentBalance * (90 / 25))
									- 50 + '%';
							$('.crosshair').css({
								left : theBalanceIncrement
							});

							var theFadeIncrement = (currentFade * (90 / 25))
									- 50 + '%';
							$('.crosshair').css({
								top : theFadeIncrement
							});
						}

						$(".crossHairContainer").mousedown(
								function(e) {
									moveCrossHair($(this), e)
									$(".crossHairContainer").bind('mousemove',
											function(e) {
												moveCrossHair($(this), e)
											});

								});
						$(document).mouseup(function() {
							$(".crossHairContainer").unbind('mousemove');
						});

						/////CHANGE THIS VARIABLE TO TRUE TO STYLE INTERFACE FOR 2D SURROUND ONLY
						var surround2D_only = true;

						// Enables/disable 2D/3D surround buttons.
						function surroundSoundModeSetup() {
							if (surround2D_only == true) {
								$('body').find('div').addClass("only2D");
							}
						}
						surroundSoundModeSetup();
					});
					
					// Takes the string sent from the buttons under the surround_btn_sets div below and
					// passes it to the tizen.most API.
					function surroundClick(id)
					{
						console.log("button "+id);
						tizen.most.setSurround(id.toString(), true, "",  function(result) {
		                				console.log(result.message);
		                             } );
					}	
					
					// By deafult, have the 2D surround sound mode/button enabled.
					function initOff()
					{
						$("on_off_btns off_btn").trigger("click");
					}
</script>


</head>

<body>

	<div id="topBarIcons"></div>

	<!-- BEGIN HTML ELEMENTS -->


	<div id="audiosettings" class="wrapper">
		<div class="contents">
			<div class="static_parts_bg"></div>
			<div class="surround_header"></div>
			<div class="surround_sound_3D"></div>

			<div class="on_off_btns">
				<div class="on_off_btn off_btn on"></div>
				<div class="on_off_btn on_btn"></div>
			</div>
			<div class="surround_btn_sets">
				<div class="surround_btns dimension2D on">
					<div class="surround_btn meridian2D on" onclick="surroundClick('meridian2D');"></div><!-- on/off for 3D -->
					<div class="surround_btn dolby" onclick="surroundClick('dolby2D');"></div>
					<div class="surround_btn dts" onclick="surroundClick('dts2D');"></div>
					<div class="surround_btn stereo" onclick="surroundClick('stereo');"></div>
				</div>
				<div class="surround_btns dimension3D">
					<div class="surround_btn meridian3D" onclick="surroundClick('meridian3D');"></div>
					<div class="surround_btn dolby" onclick="surroundClick('dolby3D');"></div>
					<div class="surround_btn dts" onclick="surroundClick('dts3D');"></div>
				</div>
			</div>
			<div class="audioDimensionTxt"></div>

			<div class="bass_display tone_txt">0</div>
			<div class="treble_display tone_txt">0</div>
			<div class="sub_display tone_txt">0</div>

			<div class="plus bass incremental_btn"></div>
			<div class="minus bass incremental_btn"></div>
			<div class="plus treble incremental_btn"></div>
			<div class="minus treble incremental_btn"></div>
			<div class="plus sub incremental_btn"></div>
			<div class="minus sub incremental_btn"></div>

			<div class="noUiSliderBass bassSlider"></div>
			<div class="noUiSliderTreble trebleSlider"></div>
			<div class="noUiSliderSub subSlider"></div>
			<div class="land_rover_top_view"></div>
			<div class="bf_btn balanceBtn left"></div>
			<div class="bf_btn balanceBtn right"></div>
			<div class="bf_btn fadeBtn up"></div>
			<div class="bf_btn fadeBtn down"></div>
			<div class="crossHairContainer">
				<div class="crosshair"></div>
			</div>
			<!-- 
				<div class="plus vol incremental_btn"></div>
				<div class="minus vol incremental_btn"></div>
				
				<div class="noUiSliderVolumeBack"></div>
				
				<div class="noUiSliderVolume volumeSlider"></div>
				 -->

		</div>
	</div>


	<!-- END HTML ELEMENTS -->

	<div id="bottomPanel" class="bottomPanel bottomPanelImg"></div>

</body>

</html>
